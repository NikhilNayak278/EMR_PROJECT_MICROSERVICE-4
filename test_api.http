### ============================================
### DATA ACCESS SERVICE - API TESTING
### ============================================

@baseUrl = http://localhost:5000

 @token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxLCJyb2xlIjoiQURNSU4iLCJ0eXBlIjoiYWNjZXNzIiwianRpIjoiMmFkNTgyN2YtMzM0OS00ZWI5LTgxMjgtYzRiNDIyOTFhNTBkIiwiaWF0IjoxNzY2NDY2ODg1LCJleHAiOjE3NjY1NTMyODV9.99HeTYcsNVW9EjvAx1__CehxF9W35LVR5XW2maby8d8

### ============================================
### 1. HEALTH & STATUS CHECKS
### ============================================

### Health Check
GET {{baseUrl}}/api/health

### ============================================
### 2. AUTHENTICATION ENDPOINTS
### ============================================

### Login as Admin
# @name loginAdmin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}

### Login as Doctor
# @name loginDoctor
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "doctor1",
  "password": "doctor123"
}

### Login as Nurse
# @name loginNurse
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "nurse1",
  "password": "nurse123"
}

### Login as Patient
# @name loginPatient
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "patient1",
  "password": "patient123"
}

### Login as Viewer
# @name loginViewer
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "viewer1",
  "password": "viewer123"
}

### Register New User
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "username": "new_doctor",
  "email": "new_doctor@hospital.com",
  "password": "password123",
  "role": "DOCTOR"
}

### Refresh Token (Use refresh_token from login response)
POST {{baseUrl}}/api/auth/refresh
Content-Type: application/json

{
  "refresh_token": "{{loginAdmin.response.body.refresh_token}}"
}

### Logout (Requires valid access_token)
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer {{loginAdmin.response.body.access_token}}


### ============================================
### 3. FHIR RESOURCES (READ & SEARCH)
### ============================================

### Get Specific Patient (Requires ID)
GET {{baseUrl}}/api/fhir/Patient/pat-001
Authorization: Bearer {{token}}

### Get Specific Observation (Requires ID)
GET {{baseUrl}}/api/fhir/Observation/obs-001
Authorization: Bearer {{token}}

### Search/List Patients (CORRECTED ENDPOINT)
# Uses /api/fhir/search instead of /api/fhir/Patient
GET {{baseUrl}}/api/fhir/search?type=Patient&limit=10
Authorization: Bearer {{token}}

### Search/List Observations (CORRECTED ENDPOINT)
GET {{baseUrl}}/api/fhir/search?type=Observation&limit=20
Authorization: Bearer {{token}}

### Search Observations for Specific Patient
GET {{baseUrl}}/api/fhir/search?type=Observation&patient=pat-001
Authorization: Bearer {{token}}
### Get Complete Patient Bundle (All records)
GET {{baseUrl}}/api/fhir/patient/pat-001/complete
Authorization: Bearer {{token}}


### ============================================
### 4. DATA UPLOAD & PROCESSING (MS3 INTEGRATION)
### ============================================

### Upload Transaction Bundle (from MS3)
POST {{baseUrl}}/api/fhir/bundle/upload
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "resourceType": "Bundle",
  "type": "transaction",
  "entry": [
    {
      "resource": {
        "resourceType": "Patient",
        "id": "new-pat-001",
        "name": [{"family": "Test", "given": ["Job"]}]
      },
      "request": {
        "method": "POST",
        "url": "Patient"
      }
    }
  ]
}

### Process Document (Trigger MS3 Mapper)
POST {{baseUrl}}/api/fhir/document/process
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "document_type": "Medical Report",
  "extracted_data": {
    "patient_name": "John Doe",
    "diagnosis": "Fever"
  }
}


### ============================================
### 5. ADMIN OPERATIONS
### ============================================

### Get Audit Logs
GET {{baseUrl}}/api/admin/audit-logs?limit=20
Authorization: Bearer {{token}}
### Get User Activity
GET {{baseUrl}}/api/admin/user-activity/1
Authorization: Bearer {{token}}

### Delete Patient Data (WARNING: IRREVERSIBLE)
# DELETE {{baseUrl}}/api/fhir/patient/pat-001
# Authorization: Bearer {{loginAdmin.response.body.access_token}}
